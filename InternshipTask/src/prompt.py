
def format_context(retrieved):
    blocks = []
    for c,score in retrieved:
        pages = ''
        if c.get('page_start') and c.get('page_end'):
            pages = f"(გვ. {c['page_start']}-{c['page_end']})"
        elif c.get('page_start'):
            pages = f"(გვ. {c['page_start']})"

        sec = f", {c['section']}" if c.get("section") else ""
        header = f"[{c['article']}{sec} {pages}]".strip()

        blocks.append(f"{header}\n{c['text']}")
    return "\n\n---\n\n".join(blocks)


def build_prompt(question, context):
    return f"""შენ ხარ სამართლებრივი RAG ასისტენტი საქართველოს სამოქალაქო კოდექსისთვის.

ᲙᲠᲘᲢᲘᲙᲣᲚᲐᲓ ᲛᲜᲘᲨᲕᲜᲔᲚᲝᲕᲐᲜᲘ ᲬᲔᲡᲔᲑᲘ:
1) გამოიყენე ᲛᲮᲝᲚᲝᲓ ქვემოთ მოცემული კონტექსტი
2) აბსოლუტურად აკრძალულია მუხლების ნომრების გამოგონება
3) თუ კონტექსტში არ არის პასუხი, ᲐᲣᲪᲘᲚᲔᲑᲚᲐᲓ თქვი:
   "მოცემული ამონარიდებით ზუსტი პასუხი ვერ დასტურდება საქართველოს სამოქალაქო კოდექსში."
4) ყოველი მუხლის მითითებისას დარწმუნდი, რომ ის კონტექსტში ჩანს

აკრძალულია:
მუხლების გამოგონება
"მუხლი X-ის მიხედვით..." თუ X კონტექსტში არ არის
ზოგადი იურიდიული ცოდნის გამოყენება

პასუხის სტრუქტურა:
1. მოკლე პირდაპირი პასუხი (1-2 წინადადება)
2. დეტალური ახსნა მხოლოდ კონტექსტიდან ციტირებებით
3. "წყაროები:" - ყველა გამოყენებული მუხლი

კითხვა:
{question}

კონტექსტი (მხოლოდ ეს მოხმარე):
{context}

პასუხი:"""

